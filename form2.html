<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add Material - Perfumer's Shelf</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="bg-image"></div>
    <div class="main-canvas">
        <header class="home">
            <div class="container">
                <div id="mate-brand">
                    <a href="index.html">
                        <img src="logo2.png" alt="logo" class="logo">
                    </a>
                </div>
                <nav id="main-navigation">
                    <ul>
                        <li><a href="/naturals.html">Naturals</a></li>
                        <li><a href="/synthetics.html">Synthetics</a></li>
                        <li><a href="/formulator.html">Formulator</a></li>
                        <li><a href="/library.html">Library</a></li>
                        <li><a href="/collections.html">Collections</a></li>
                    </ul>
                </nav>
            </div>
        </header>

        <div class="overlay-container">
            <section class="materials">
                <h1>Add New Material to Collection</h1>
                <form id="newMaterialForm">
                    <input type="hidden" id="dateAdded" name="dateAdded">
                    
                    <label for="name">Material Name:</label>
                    <input type="text" id="name" name="name" placeholder="e.g., Bergamot Essence" required>
                    
                    <label for="link">Purchase Link:</label>
                    <input type="url" id="link" name="link" placeholder="e.g., https://example.com" required>
                    
                    <label for="totalMl">Total Quantity (g):</label>
                    <input type="number" step="0.001" id="totalMl" name="totalMl" placeholder="e.g., 100" required>
                    
                    <label for="totalPrice">Total Price (Ft):</label>
                    <input type="number" step="0.01" id="totalPrice" name="totalPrice" placeholder="e.g., 200" required>
                    
                    <button type="submit">Add Material</button>
                </form>
                <div id="successMessage" style="display: none; color: green; margin-top: 10px;">
                    Material successfully added!
                </div>
                <div id="errorMessage" style="display: none; color: red; margin-top: 10px;">
                    Error adding material. Please try again.
                </div>
            </section>
        </div>
    </div>

    <script>
        // Automatically set the current date in the hidden field
        document.addEventListener('DOMContentLoaded', () => {
            const today = new Date();
            const formattedDate = today.toISOString().split('T')[0]; // Format as YYYY-MM-DD
            document.getElementById('dateAdded').value = formattedDate;
        });

        document.getElementById('newMaterialForm').onsubmit = async function (e) {
            e.preventDefault();

            // Gather form data
            const formData = {
                name: document.getElementById('name').value,
                date_added: document.getElementById('dateAdded').value,
                link: document.getElementById('link').value,
                total_ml: parseFloat(document.getElementById('totalMl').value),
                total_price: parseFloat(document.getElementById('totalPrice').value)
            };

            try {
                // Save material to JSON file via backend
                const response = await fetch('http://127.0.0.1:5000/add_material', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData)
                });

                if (response.ok) {
                    document.getElementById('successMessage').style.display = 'block';
                    document.getElementById('errorMessage').style.display = 'none';
                    document.getElementById('newMaterialForm').reset(); // Clear the form
                } else {
                    throw new Error('Failed to add material');
                }
            } catch (error) {
                console.error('Error adding material:', error);
                document.getElementById('successMessage').style.display = 'none';
                document.getElementById('errorMessage').style.display = 'block';
            }
        };
    </script>
</body>
</html>
